{"ast":null,"code":"import\"antd-mobile/lib/button/style\";import _Button from\"antd-mobile/lib/button\";import _regeneratorRuntime from\"/Users/wlp6897/newProjects/cordovaProjects/installment/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import\"antd-mobile/lib/toast/style\";import _Toast from\"antd-mobile/lib/toast\";import _objectSpread from\"/Users/wlp6897/newProjects/cordovaProjects/installment/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/wlp6897/newProjects/cordovaProjects/installment/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/wlp6897/newProjects/cordovaProjects/installment/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/wlp6897/newProjects/cordovaProjects/installment/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/wlp6897/newProjects/cordovaProjects/installment/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/wlp6897/newProjects/cordovaProjects/installment/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import Routers from'@/plugins/libs/routerMap';import{BrowserRouter as Router,Route}from'react-router-dom';import{connect}from'react-redux';import{CLIENT_INTERFACE}from'@/plugins/libs/interfaceMap';import{SET_USER_INFO,SET_REDIRECT}from'@/store/actions';import axios from'axios';import{getStorage}from'@/plugins/common/storage';import Login from'@/views/Login';import Main from'@/views/Main';var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.fetchCheckLogin=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var storageUserInfo,res,userData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!_this.props.user.isAuth){_context.next=3;break;}if(window.location.pathname==='/login'){window.location.pathname='/main';}return _context.abrupt(\"return\");case 3://本地是否有存储用户信息\nstorageUserInfo=getStorage('storageUserInfo');if(storageUserInfo){_context.next=6;break;}return _context.abrupt(\"return\");case 6:if(!(!storageUserInfo.accountId||!storageUserInfo.accountType||!storageUserInfo.token)){_context.next=8;break;}return _context.abrupt(\"return\");case 8:_context.prev=8;_context.next=11;return axios({url:CLIENT_INTERFACE.CHECK_IS_LOGIN,method:'post',headers:{'Content-Type':'application/json; charset=UTF-8'},data:_objectSpread({},storageUserInfo)});case 11:res=_context.sent;if(!(res.data.err!=='0')){_context.next=15;break;}_Toast.info(res.data.msg,1);return _context.abrupt(\"return\");case 15:userData=_objectSpread(_objectSpread({},storageUserInfo),{},{token:res.data.result.token});_this.props.setUserInfo(userData);if(window.location.pathname==='/login'){window.location.pathname='/main';}console.log('已经登录了');_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](8);console.log(_context.t0);case 24:case\"end\":return _context.stop();}}},_callee,null,[[8,21]]);}));return _this;}_createClass(App,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this.fetchCheckLogin();case 2:case\"end\":return _context2.stop();}}},_callee2,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()//是否已经登录过及查证token是否是有效登录，并更新token\n},{key:\"render\",value:function render(){var isAuth=this.props.user.isAuth;return/*#__PURE__*/React.createElement(Router,null,/*#__PURE__*/React.createElement(_Button,{type:\"primary\"},\"\\u4F60\\u597D\\u554A\"),Routers.map(function(item,index){if(item.path!=='/login'){return/*#__PURE__*/React.createElement(Route,{path:item.path,key:index,exact:true,component:item.isAuth&&!isAuth?Login:item.component});}else{return/*#__PURE__*/React.createElement(Route,{path:item.path,key:index,exact:true,component:isAuth?Main:item.component});}}));}}]);return App;}(React.Component);export default connect(function(state,props){return state;},{setUserInfo:function setUserInfo(data){return{type:SET_USER_INFO,data:data};},setRedirectPath:function setRedirectPath(data){return{type:SET_REDIRECT,data:data};}})(App);","map":null,"metadata":{},"sourceType":"module"}